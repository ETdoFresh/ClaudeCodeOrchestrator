<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:dock="using:Dock.Avalonia.Controls"
        xmlns:vm="using:ClaudeCodeOrchestrator.App.ViewModels"
        xmlns:dockVm="using:ClaudeCodeOrchestrator.App.ViewModels.Docking"
        xmlns:panels="using:ClaudeCodeOrchestrator.App.Views.Panels"
        mc:Ignorable="d" d:DesignWidth="1200" d:DesignHeight="800"
        x:Class="ClaudeCodeOrchestrator.App.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Title="{Binding WindowTitle}"
        Icon="/icons/orchestrator-wand.ico"
        Width="1200" Height="800"
        MinWidth="800" MinHeight="600"
        Background="#1E1E1E"
        DragDrop.AllowDrop="True">

    <Window.DataTemplates>
        <!-- File Browser -->
        <DataTemplate DataType="{x:Type dockVm:FileBrowserViewModel}">
            <panels:FileBrowserView />
        </DataTemplate>

        <!-- Diff Browser -->
        <DataTemplate DataType="{x:Type dockVm:DiffBrowserViewModel}">
            <panels:DiffBrowserView />
        </DataTemplate>

        <!-- Session Document -->
        <DataTemplate DataType="{x:Type dockVm:SessionDocumentViewModel}">
            <panels:SessionView />
        </DataTemplate>

        <!-- Worktrees -->
        <DataTemplate DataType="{x:Type dockVm:WorktreesViewModel}">
            <panels:WorktreesView />
        </DataTemplate>

        <!-- File Document -->
        <DataTemplate DataType="{x:Type dockVm:FileDocumentViewModel}">
            <panels:FileView />
        </DataTemplate>

        <!-- Diff Document -->
        <DataTemplate DataType="{x:Type dockVm:DiffDocumentViewModel}">
            <panels:DiffView />
        </DataTemplate>

        <!-- Settings -->
        <DataTemplate DataType="{x:Type dockVm:SettingsViewModel}">
            <panels:SettingsView />
        </DataTemplate>
    </Window.DataTemplates>

    <Grid RowDefinitions="Auto,*">
        <!-- Title Bar and Menu -->
        <Grid Grid.Row="0" Background="#333333" ColumnDefinitions="Auto,*,Auto">
            <!-- Menu Bar -->
            <Menu Grid.Column="0" Background="#333333" AutomationProperties.AutomationId="MainMenu">
            <MenuItem Header="_File" AutomationProperties.AutomationId="FileMenu">
                <MenuItem Header="_Open Repository..." Command="{Binding OpenRepositoryCommand}"
                          AutomationProperties.AutomationId="OpenRepositoryMenuItem" />
                <MenuItem Header="_Recent Repositories"
                          IsVisible="{Binding HasRecentRepositories}"
                          AutomationProperties.AutomationId="RecentRepositoriesMenuItem"
                          ItemsSource="{Binding RecentRepositories}">
                    <MenuItem.ItemContainerTheme>
                        <ControlTheme TargetType="MenuItem" x:DataType="vm:RecentRepositoryItem">
                            <Setter Property="Header" Value="{Binding DisplayName}" />
                            <Setter Property="Command" Value="{Binding OpenCommand}" />
                            <Setter Property="ToolTip.Tip" Value="{Binding Path}" />
                        </ControlTheme>
                    </MenuItem.ItemContainerTheme>
                </MenuItem>
                <Separator />
                <MenuItem Header="_Close Repository" Command="{Binding CloseRepositoryCommand}"
                          IsEnabled="{Binding IsRepositoryOpen}"
                          AutomationProperties.AutomationId="CloseRepositoryMenuItem" />
                <Separator />
                <MenuItem Header="E_xit" AutomationProperties.AutomationId="ExitMenuItem" />
            </MenuItem>
            <MenuItem Header="_Repository" AutomationProperties.AutomationId="RepositoryMenu">
                <MenuItem Header="_Refresh" Command="{Binding RefreshWorktreesCommand}"
                          IsEnabled="{Binding IsRepositoryOpen}"
                          AutomationProperties.AutomationId="RefreshMenuItem" />
                <Separator />
                <MenuItem Header="P_ull" Command="{Binding PullCommand}"
                          IsEnabled="{Binding IsRepositoryOpen}"
                          AutomationProperties.AutomationId="PullMenuItem" />
                <MenuItem Header="_Push" Command="{Binding PushAllBranchesCommand}"
                          IsEnabled="{Binding IsRepositoryOpen}"
                          AutomationProperties.AutomationId="PushMenuItem" />
                <Separator />
                <MenuItem Header="Open in _Browser" Command="{Binding OpenRepoCommand}"
                          IsEnabled="{Binding GitHubUrl, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                          AutomationProperties.AutomationId="OpenInBrowserMenuItem" />
            </MenuItem>
            <MenuItem Header="_View" AutomationProperties.AutomationId="ViewMenu">
                <MenuItem Header="Split All Tabs _Vertically" Command="{Binding SplitVerticalCommand}"
                          AutomationProperties.AutomationId="SplitVerticalMenuItem" />
                <MenuItem Header="Split All Tabs _Horizontally" Command="{Binding SplitHorizontalCommand}"
                          AutomationProperties.AutomationId="SplitHorizontalMenuItem" />
                <MenuItem Header="Split All Tabs in _Grid" Command="{Binding SplitGridCommand}"
                          AutomationProperties.AutomationId="SplitGridMenuItem" />
                <MenuItem Header="_Collapse Split Tabs" Command="{Binding CollapseSplitCommand}"
                          AutomationProperties.AutomationId="CollapseSplitMenuItem" />
                <Separator />
                <MenuItem Header="Auto-Split _Vertically" Command="{Binding AutoSplitVerticalCommand}"
                          AutomationProperties.AutomationId="AutoSplitVerticalMenuItem" />
                <MenuItem Header="Auto-Split H_orizontally" Command="{Binding AutoSplitHorizontalCommand}"
                          AutomationProperties.AutomationId="AutoSplitHorizontalMenuItem" />
                <MenuItem Header="Auto-Split G_rid" Command="{Binding AutoSplitGridCommand}"
                          AutomationProperties.AutomationId="AutoSplitGridMenuItem" />
                <MenuItem Header="_Disable Auto-Split" Command="{Binding DisableAutoSplitCommand}"
                          AutomationProperties.AutomationId="DisableAutoSplitMenuItem" />
                <Separator />
                <MenuItem Header="_Reset to Default View" Command="{Binding ResetViewCommand}"
                          AutomationProperties.AutomationId="ResetViewMenuItem" />
            </MenuItem>
            <MenuItem Header="_Help" AutomationProperties.AutomationId="HelpMenu">
                <MenuItem Header="_About" Command="{Binding ShowAboutCommand}"
                          AutomationProperties.AutomationId="AboutMenuItem" />
            </MenuItem>
        </Menu>

            <!-- Window Title Display with Play and Cog -->
            <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Center" Margin="0,0,100,0">
                <TextBlock Text="{Binding WindowTitle}"
                           VerticalAlignment="Center"
                           Foreground="#999999"
                           FontSize="13" />
                <!-- Repo Settings Button (cog icon, only visible when repository is open) -->
                <Button Content="⚙"
                        Command="{Binding OpenRepositorySettingsCommand}"
                        IsVisible="{Binding IsRepositoryOpen}"
                        Background="Transparent"
                        Foreground="#808080"
                        FontSize="12"
                        Padding="4,2"
                        Margin="6,0,0,0"
                        Cursor="Hand"
                        ToolTip.Tip="Repository Settings"
                        AutomationProperties.AutomationId="RepoSettingsButton">
                    <Button.Styles>
                        <Style Selector="Button:pointerover">
                            <Setter Property="Foreground" Value="#CCCCCC" />
                        </Style>
                    </Button.Styles>
                </Button>
                <!-- Run Main Repo Button (play icon, only visible when executable is configured) -->
                <Button Content="▶"
                        Command="{Binding RunMainRepoCommand}"
                        IsVisible="{Binding CanRunMainRepo}"
                        Background="Transparent"
                        Foreground="#4EC9B0"
                        FontSize="10"
                        Padding="8,4"
                        Margin="6,0,0,0"
                        Cursor="Hand"
                        ToolTip.Tip="Run application in main repository"
                        AutomationProperties.AutomationId="RunMainRepoButton">
                    <Button.Styles>
                        <Style Selector="Button:pointerover">
                            <Setter Property="Foreground" Value="#6FFFDF" />
                        </Style>
                    </Button.Styles>
                </Button>
            </StackPanel>

            <!-- Right Side Items -->
            <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Right" Margin="0,0,12,0">
                <!-- Auto-Split Indicator -->
                <TextBlock Text="{Binding AutoSplitLayoutText}"
                           IsVisible="{Binding AutoSplitLayoutText, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                           VerticalAlignment="Center"
                           Foreground="#6CA0DC"
                           FontSize="12"
                           Margin="0,0,12,0"
                           AutomationProperties.AutomationId="AutoSplitIndicator" />
                <!-- Repo Link (only visible for GitHub repositories) -->
                <Button Content="Repo"
                        Command="{Binding OpenRepoCommand}"
                        IsVisible="{Binding GitHubUrl, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                        Background="Transparent"
                        Foreground="#6CA0DC"
                        FontSize="12"
                        Padding="8,4"
                        Cursor="Hand"
                        AutomationProperties.AutomationId="RepoLink">
                    <Button.Styles>
                        <Style Selector="Button:pointerover">
                            <Setter Property="Foreground" Value="#8FBAEC" />
                        </Style>
                    </Button.Styles>
                </Button>
                <!-- Usage Link -->
                <Button Content="Usage"
                        Command="{Binding OpenUsageCommand}"
                        Background="Transparent"
                        Foreground="#6CA0DC"
                        FontSize="12"
                        Padding="8,4"
                        Cursor="Hand"
                        AutomationProperties.AutomationId="UsageLink">
                    <Button.Styles>
                        <Style Selector="Button:pointerover">
                            <Setter Property="Foreground" Value="#8FBAEC" />
                        </Style>
                    </Button.Styles>
                </Button>
            </StackPanel>
        </Grid>

        <!-- Dock Control -->
        <dock:DockControl Grid.Row="1"
                          Layout="{Binding Layout}"
                          InitializeLayout="True" />
    </Grid>
</Window>
